<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Training Book</title>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.2/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" rel="stylesheet">
    <style>.content {padding-top: 50px;} a.brand {color: #fff } option:disabled { background:#dddddd; }</style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
    <!--http://ajax.aspnetcdn.com/ajax/knockout/knockout-3.0.0.js-->
</head>

<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">My Training Book <small>Starring Flask, MongoDB and MongoEngine</small></a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="home.html">Home</a></li>
                <li><a href="workouts.html">Workouts</a></li>
                <li><a href="cycles.html">Cycles</a></li>
                <li class="active"><a href="exercises.html">Exercises</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>

<div id="main" class="container">
    <div class="content">
        <h1>Exercises <button data-bind="click: beginAdd" class="btn btn-primary btn-large"><i class="fa fa-plus-circle"></i></button></h1>
        <table class="table table-hover table-condensed">
            <thead>
                <th>Name</th>
                <th>Muscles</th>
                <th>Description</th>
                <th></th>
            </thead>
            <tbody>
                <!-- ko foreach: exercises -->
                <tr>
                    <td><span data-bind="text: name"></span></td>
                    <td>
                        <ul data-bind="foreach: muscles">
                            <li><span data-bind="text: $data"></span></li>
                        </ul>
                    </td>
                    <td><p data-bind="text: description"></p></td>
                    <td><button data-bind="click: $parent.beginEdit" class="btn btn-primary"><i class="fa fa-pencil"></i></button></td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">
    function ExercisesViewModel() {
        var self = this;
        self.exercisesURI = 'http://localhost/rest/gym/api/v1.0/exercises';
        self.exercises = ko.observableArray();

        self.ajax = function(uri, method, data) {
            var request = {
                url: uri,
                type: method,
                contentType: "application/json",
                accepts: "application/json",
                cache: false,
                dataType: 'json',
                data: JSON.stringify(data),
                error: function(jqXHR) {
                    console.log("ajax error " + jqXHR.status);
                }
            };
            return $.ajax(request);
        }

        self.beginAdd = function() {
            alert("Add");
        }

        self.beginEdit = function(exercise) {
            alert("Edit: " + exercise.id);
        }

        self.ajax(self.exercisesURI, 'GET').done(function(data) {
            for (var i = 0; i < data.exercises.length; i++) {
                var item = {
                    description: ko.observable(data.exercises[i].description),
                    name: ko.observable(data.exercises[i].name),
                    use_weight: ko.observable(data.exercises[i].use_weight),
                    muscles: ko.observable(data.exercises[i].muscles),
                    id: data.exercises[i].id
                };
                self.exercises.push(item);
            }
        });
    }
    ko.applyBindings(new ExercisesViewModel(), $('#main')[0]);
</script>
</body>
</html>
